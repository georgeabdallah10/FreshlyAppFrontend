# Quick Meals LLM Integration Fix

## Summary
Fixed the Quick Meals wizard to properly display questions and use the LLM to generate personalized meal recommendations based on user choices.

## Issues Fixed

### 1. **Question Component Not Displaying Content**
**Problem:** The `Question` component was rendering an empty card - missing the title and children elements.

**Solution:**
```tsx
return (
  <Animated.View style={[styles.card, { opacity }]}>
    <Text style={styles.question}>{title}</Text>
    <View style={{ gap: 10 }}>{children}</View>
  </Animated.View>
);
```

### 2. **Tag Component Not Showing Labels**
**Problem:** Ingredient tags (in Phase 4) were not displaying the ingredient name.

**Solution:**
```tsx
<Text style={[styles.tagText, /* ...styles */]}>
  {label} ×
</Text>
```

### 3. **ReviewRow Not Showing Data**
**Problem:** Review summary (Phase 5) was not displaying key-value pairs.

**Solution:**
```tsx
<View style={styles.row}>
  <Text style={styles.rowK}>{k}</Text>
  <Text style={styles.rowV}>{v}</Text>
</View>
```

### 4. **Missing Button Labels**
**Problem:** Footer buttons were only showing icons, no text.

**Solution:**
```tsx
// Back button
<Text style={[styles.btnGhostText, phase === 0 && { color: "#B8C1C7" }]}>
  Back
</Text>

// Next/Generate button
<Text style={styles.btnSolidText}>
  {phase === TOTAL_PHASES - 1 ? "Generate Meal" : "Next"}
</Text>
```

## How It Works

### Wizard Flow (6 Phases)

1. **Phase 0:** Ingredient source + Meal type selection
2. **Phase 1:** Budget + Time available
3. **Phase 2:** Goal selection (weight loss/gain/preferences)
4. **Phase 3:** Cooking methods selection
5. **Phase 4:** Include/Avoid ingredients (optional)
6. **Phase 5:** Servings + Review choices

### LLM Integration

When user completes all phases and taps "Generate Meal":

```typescript
const finish = useCallback(async () => {
  // 1. Build payload with all user choices
  const payload = {
    ingredientSource: form.ingredientSource,
    budget: form.budget,
    mealType: form.mealType,
    goal: form.goal,
    speed: form.speed,
    difficulty: form.difficulty,
    cookingMethods: form.cookingMethods,
    includeIngredients: form.includeIngredients,
    avoidIngredients: form.avoidIngredients,
    servings: form.servings,
  };

  // 2. Prepare context with user preferences, pantry, and choices
  const inputsBlock = `preferences_json:
${JSON.stringify(prefrences)}

pantry_json:
${JSON.stringify(pantryItems)}

choices_json:
${JSON.stringify(payload)}`;

  // 3. Call LLM with system + user prompts
  const res = await askAI({ 
    system: system_prompt, 
    prompt: user_prompt 
  });

  // 4. Parse response and display meal
  const meal = JSON.parse(res);
  setCurrentMeal({
    name: meal.name,
    mealType: meal.mealType,
    iconName: meal.iconName,
    ingredients: meal.ingredients,
  });
  setshowMealComponent(true);

  // 5. Save meal to database
  await handleSaveMeal(meal);
}, [form, prefrences, pantryItems]);
```

### LLM Prompt Structure

**System Prompt:**
- Role: Professional chef AI
- Task: Generate realistic, edible, delicious meals
- Constraints: Respect allergens, diet codes, user goals, cooking methods
- Output: Valid JSON only (no markdown, no comments)

**User Prompt:**
- User preferences JSON (allergens, diet, goals)
- Pantry items JSON (available ingredients)
- User choices JSON (meal type, budget, time, methods, etc.)
- JSON schema directive (exact format required)

**Expected Response:**
```json
{
  "name": "Meal Name",
  "mealType": "dinner",
  "iconName": "restaurant",
  "calories": 450,
  "prepTime": 10,
  "cookTime": 15,
  "totalTime": 25,
  "cuisine": "Italian",
  "difficulty": "easy",
  "servings": 2,
  "ingredients": ["ingredient1", "ingredient2", ...],
  "instructions": ["step1", "step2", ...],
  "cookingTools": ["pan", "spatula", ...],
  "notes": "Helpful tip"
}
```

## User Experience

1. **Progressive Disclosure:** Users answer one question at a time
2. **Visual Feedback:** Progress bar shows completion percentage
3. **Haptic Feedback:** Tactile response on selections
4. **Smooth Animations:** Questions fade in/out on phase changes
5. **Validation:** Review screen shows all choices before generating
6. **Result Preview:** Generated meal shown in expandable card with ingredients

## Components Used

- **OptionRow:** Radio/checkbox selection with animations
- **Question:** Card wrapper with title and animated fade
- **Tag:** Removable ingredient chips (green for include, red for avoid)
- **ReviewRow:** Key-value display for final review
- **RecipeItem:** Expandable meal preview card with ingredients

## Next Steps

The meal is now:
1. ✅ Generated by LLM based on user choices
2. ✅ Displayed in expandable preview card
3. ✅ Saved to database
4. ⚠️ **TODO:** Wire up the "Save Meal" button in RecipeItem to actually persist
5. ⚠️ **TODO:** Add loading state while LLM generates meal
6. ⚠️ **TODO:** Add error handling if LLM fails
7. ⚠️ **TODO:** Allow user to regenerate if they don't like the suggestion

## Testing Checklist

- [ ] Test all 6 phases display correctly
- [ ] Test ingredient tags can be added/removed
- [ ] Test review screen shows all selections
- [ ] Test "Generate Meal" calls LLM
- [ ] Test meal displays in preview card
- [ ] Test meal saves to database
- [ ] Test back navigation works
- [ ] Test animations are smooth
- [ ] Test on iOS, Android, and web

## Files Modified

- `app/(home)/quickMeals.tsx` - Fixed Question, Tag, ReviewRow components and button labels
