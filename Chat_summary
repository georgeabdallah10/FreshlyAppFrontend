Chat service overview (no image or meal-generation flows):
- API surface (`src/services/chat.service.ts`, mirrored in `src/home/chat.ts` for RN use): send messages to `/chat` with `{prompt, system, conversation_id}`; list conversations (`/chat/conversations`), fetch a single conversation and its messages, update title (PATCH `/chat/conversations/:id`), delete conversation (DELETE), plus a convenience `askAI` wrapper when no history is needed.
- State/query layer (`hooks/useChat.ts`, `src/config/queryClient.ts`): React Query keys for chat, conversation, and messages. Mutations optimistically append the user message, then append the assistant reply from the API response and invalidate the conversation list so previews stay fresh. Deletion/rename mutations invalidate chat queries to keep local state in sync.
- Conversation UX (`app/(main)/(home)/chat.tsx`): Sidebar lists prior conversations, lets users create/rename/delete, and loads history on selection. Loading a conversation filters out system/image payloads, maps stored messages into UI bubbles, and captures the first user prompt for previews. Starting a new conversation clears the message list and sets the active `conversationId`.
- Messaging flow (`app/(main)/(home)/chat.tsx` send path): validates text with `validateChatMessage` (`src/utils/chatValidation.ts` blocks non-food/jailbreak/harmful, enforces 1k-char limit and 1.5s throttle), then sends `{prompt, system, conversationId}` to `/chat`. If no `conversationId` is active, it uses the `conversation_id` returned from the backend to start a fresh thread and reloads the conversation list. UI shows a typing indicator while awaiting the reply, then renders assistant text (or recipe card if reply parses as JSON) and keeps conversation context for subsequent turns.
- Persistence & context: Each message round-trips with a `conversation_id`, so back-to-back calls reuse history and the backend can respond contextually. Users can hop between past conversations via the sidebar, making the interaction feel like a standard chat bot with full conversation continuity rather than one-off prompts.
